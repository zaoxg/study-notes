---
typora-root-url: images
typora-copy-images-to: images
---

# 异步函数
## coroutine
### 判断是否是coroutine
```python
import asyncio
from inspect import iscoroutine, iscoroutinefunction, isawaitable

async def calling_async_test():
    await asyncio.sleep(3)

print('<calling_async_test is coroutine %s' % iscoroutine(calling_async_test()))
print('<calling_async_test()> is coroutine %s' % iscoroutine(calling_async_test()))
```
#### 运行结果
```
<calling_async_test> is coroutine False
<calling_async_test()> is coroutine True
```
异步函数未调用前不是 coroutine
异步函数调用后是 coroutine

### 判断是否是coroutine function
```python
print('<calling_async_test> is coroutinefunction %s' % iscoroutinefunction(calling_async_test))
print('<calling_async_test()> is coroutinefunction %s' % iscoroutinefunction(calling_async_test()))
```


#### 运行结果
```
<calling_async_test> is coroutinefunction True
<calling_async_test()> is coroutinefunction False
```
使用async语法糖的函数是 coroutinefunction
使用async包装的函数执行后不是 coroutinefunction

### 是否是可等待的
```python
print('<calling_async_test is awaitable %s' % isawaitable(calling_async_test)
print('<calling_async_test()> is awaitable %s' % isawaitable(calling_async_test()))
```
#### 执行结果
```python
<calling_async_test is awaitable False
<calling_async_test()> is awaitable True
```
异步函数调用后是一个awaitable对象

## 使用装饰器装饰
### 使用同步方法执行异步函数
```python
def sync_wrapper(func):
    """
    同步调用异步装饰器
    :param func: 异步方法
    :return:
    """
    @functools.wraps(func)
    async def wrapper(*args, **kwargs):  # 是否使用async语法糖影响inspect的判断
        try:
            # 获取一个正在运行的时间循环
            loop = asyncio.get_running_loop()
        except RuntimeError:
            return asyncio.run(
                func(*args, **kwargs))
        else:
            return loop.run_until_complete(
                func(*args, **kwargs))
    return wrapper
```

